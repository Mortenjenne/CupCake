<!DOCTYPE html>
<html lang="da" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Olsker Cupcakes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- Thymeleaf vil erstatte th:href; den “plain” href virker ved ren statisk visning -->
    <link rel="stylesheet" href="/public/css/stylesheet.css" th:href="@{/css/stylesheet.css}"/>
</head>
<body>

<div th:replace="fragments :: headerFragment"></div>

<main>

    <section class="index-body">
        <section class="welcome">
            <h1>Velkommen til Olsker Cupcakes</h1>
            <h2>Øens bedste cupcakes</h2>
        </section>

        <section class="cupcake-box">
                <img class="topping-img" src="/public/images/cupcakes/toppings/topping_strawberry.png"
                     th:src="@{/images/cupcakes/toppings/topping_strawberry.png}"
                     alt="cupcake Topping"/>
                <img class="bottom-img" src="/public/images/cupcakes/bottoms/bottom_chocolate.png"
                     th:src="@{/images/cupcakes/bottoms/bottom_chocolate.png}"
                     alt="Cupcake Bottom"/>
        </section>

        <section class="cupcake-creator">
            <h4>Vælg og bestil her</h4>

            <form method="post" th:action="@{/cart/add}">
                <select name="bottomId" id="bottomSelect" required>
                    <option value="">Vælg Bund</option>
                    <option th:each="b : ${bottoms}"
                            th:value="${b.bottomId}"
                            th:text="${b.name + ' + ' + b.price + 'kr'}"
                            th:attr="data-img=@{/images/cupcakes/bottoms/bottom_{slug}.png(
                            slug=${#strings.toLowerCase( (b.name != null ? b.name.replaceAll('\\W+', '') : '') )})}">
                    </option>
                </select>
                <select name="toppingId" id="toppingSelect" required>
                    <option value="">Vælg Topping</option>
                    <option th:each="t : ${toppings}"
                            th:value="${t.toppingId}"
                            th:text="${t.name + ' + ' + t.price + 'kr'}"
                            th:attr="data-img=@{/images/cupcakes/toppings/topping_{slug}.png(slug=${t.slug})}"
                    >
                    </option>

                </select>



                <input type="number" name="cupcakeQuantity" min="1" placeholder="1" th:value="${cupcakeQuantity}" required>

                <button type="submit">Tilføj til kurv</button>
                <p th:if="${succesLabel != null}" th:text="${succesLabel}"></p>
                <p th:if="${session.indexErrorLabel != null}" th:text="${session.indexErrorLabel}"></p>

            </form>
        </section>


    </section>

</main>

<div th:replace="fragments :: footerFragment"></div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const bottomSelect  = document.getElementById("bottomSelect");
        const toppingSelect = document.getElementById("toppingSelect");
        const bottomImg     = document.querySelector(".bottom-img");
        const toppingImg    = document.querySelector(".topping-img");

        function updateImage(selectEl, imgEl, fallbackSrc) {
            const selected = selectEl.selectedOptions[0];
            const imgUrl = selected ? selected.dataset.img : null;
            if (imgUrl) {
                imgEl.src = imgUrl;
            } else if (fallbackSrc) {
                imgEl.src = fallbackSrc;
            }
        }

        bottomSelect.addEventListener("change", () => updateImage(bottomSelect, bottomImg));
        toppingSelect.addEventListener("change", () => updateImage(toppingSelect, toppingImg));
    });
</script>

</body>
</html>
